<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Adyen-python-api-library by Adyen</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Adyen-python-api-library</h1>
        <p>Adyen API Library for Python</p>

        <p class="view"><a href="https://github.com/Adyen/adyen-python-api-library">View the Project on GitHub <small>Adyen/adyen-python-api-library</small></a></p>

        <br>
        <a title="Installation" href="index.html">Installation</a><br>
        <a title="Using api features" href="using-library.html">Using api features</a>
        <br><br>



        <ul>
          <li><a href="https://github.com/Adyen/adyen-python-api-library/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Adyen/adyen-python-api-library/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Adyen/adyen-python-api-library">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>


      <h1 id="card">Card Payments</h1>
        <h2 id="authorise">authorise</h2>
        <p>
          With the authorise method, a payment is authorised against a shopper's payment method.<br><br>
          For credit card payments you can choose between full API integration (for PCI compliant merchants) or our client side encryption solution.<br>
          The client side encryption solution is recommended since it is easier to implement.

          The 'merchantAccount' property is optional, by default the value set with the merchant_account attribute on the Adyen class instance is used.
          This value can be changed when payments should be processed over a different merchant account.<br><br>

          The 'reference' property for each call is a custom id assigned by your application to identify a payment at a later point in time.
          This is useful for reconciliation of payments with sales in your system, when using payment reports or when 'server notifications' are enabled.
        </p>

        <h3 id="ee">Client Side Encryption</h3>

        <p>Client Side Encryption is the most common use case of the api. Card data is encrypted client side, in a mobile app or website, with the Adyen Client Side Encryption library.
          The encrypted data is sent to your server, where using the python api, the payment can be authorised with Adyen. This solution does not require a PCI compliance audit.<br><br>
          This Adyen client side encryption library is available for:<br>
          - <a href="https://github.com/Adyen/adyen-cse-web">Web</a><br>
          - <a href="https://github.com/Adyen/adyen-cse-ios">iOS</a><br>
          - <a href="https://github.com/Adyen/adyen-cse-android">Android</a><br><br>

          The encrypted card data is added to the authorise request. In the example below it is directly get from the client request headers.
        </p>

        <pre>
          <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request[<span class="hljs-string">'additionalData'</span>] = {<span class="hljs-string">"card.encrypted.json"</span>:headers[<span class="hljs-string">'adyen_encrypted_data'</span>]}
request[<span class="hljs-string">'amount'</span>] = {<span class="hljs-string">"value"</span>:<span class="hljs-string">"12345"</span>,<span class="hljs-string">"currency"</span>:<span class="hljs-string">"USD"</span>]}
request[<span class="hljs-string">'reference'</span>] = "unique payment reference"
request[<span class="hljs-string">'merchantAccount'</span>] = "your merchant account name"<br>
result = adyenbase.payment.authorise(request=request)
          </code>
        </pre>

        <h3 id="api">API</h3>

        <p>
          With API payments, card data is passed directly to the library.
        </p>

        <pre>
          <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request[<span class="hljs-string">'amount'</span>] = {<span class="hljs-string">"value"</span>:<span class="hljs-string">"12345"</span>,<span class="hljs-string">"currency"</span>:<span class="hljs-string">"USD"</span>}

request['card'] = {
  "number":"4111111111111111",
  "expiryMonth":"06",
  "expiryYear": "2016".
  "cvc": "737",
  "holderName": "John Smith"
}

request[<span class="hljs-string">'merchantAccount'</span>] = "your merchant account name"
request[<span class="hljs-string">'reference'</span>] = "unique payment reference"
result = adyenbase.payment.authorise(request=request)
          </code>
        </pre>

        <h2 id="recurring">Recurring</h2>

        <h3 id="creating_recurring">Creating a recurring contract</h3>

        <p>
          To create a recurring contract, add the following parameters to a standard payment request ( in addition to the parameters as shown
          above ). The same 'authorise' method is used for setting up a recurring contract.<br><br>
          Possible types of recurring contracts:<br>
          - <b>ONECLICK</b><br>
          The shopper opts to store their card details for future use. The shopper is present for the subsequent transaction, for cards the security code (CVC/CVV) is required.<br>
          - <b>RECURRING</b><br>
          Payment details are stored for future use. For cards, the security code (CVC/CVV) is not required for subsequent payments. This is used for shopper not present transactions.<br>
          - <b>ONECLICK, RECURRING</b><br>
          Payment details are stored for future use. This allows the use of the stored payment details regardless of whether the shopper is on your site or not.<br>
        </p>


        <pre>
          <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request['recurring']['contract'] = "ONE CLICK, RECURRING or ONECLICK,RECURRING"
request['shopperEmail'] = 'shopper email address'
request['shopperReference'] = 'shopper first & last name'
result = adyen.payment.authorise(request=request)
          </code>
        </pre>

        <h3 id="recurring_payment">Making a recurring payment</h3>
        <p>
          To submit a payment for a recurring contract, the 'selectedRecurringDetailReference' and 'shopperInteraction' properties need
          to be added to the request dict to the 'authorise' method.<br><br>
          The value of the selectedRecurringDetailReference is set to either:<br>
          - a recurringDetailReference<br>
          - The string “LATEST” to use the most recently stored recurring detail<br><br>
          A "recurring detail reference" can be retrieved by listing all recurring contracts for a shopper. The shopper email, shopper reference
          must be identical to those for which the recurring contract is setup.<br><br>
          <h4>One click payments</h4>
          To allow shoppers to make quick purchases, 'one click' recurring contracts can be used. To submit a one click payment based on a recurring
          contract, set the 'shopperInteraction' to 'Ecommerce' and the 'recurring>contract' value to 'ONECLICK'. The created recurring contract must be of
          the type 'ONECLICK' or 'ONECLICK,RECURRING' to allow for one click payments.<br><br>
          <h4>Recurring payment</h4>
          For a 'regular' recurring payment, meaning the shopper does directly interact with your system for a purchase ( such as subscriptions ), the
          'shopperInteraction' is set to 'ContAuth' and the 'recurring>contract' value is set to 'RECURRING', the created recurring contract in this case
          must be either of type 'RECURRING' or 'ONECLICK,RECURRING'.<br><br>

          Code example for recurring payment:
        </p>


        <pre>
          <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request["shopperEmail"] = "shopper email address"
request["shopperReference"] = "shopper first & last name"

request["selectedRecurringDetailReference"] = "LATEST or recurringDetailReference"
request["shopperInteraction"] = "ContAuth or Ecommerce"
request['recurring'] = {}
request["recurring"]['contract'] = "RECURRING or ONECLICK"
result = ady.payment.authorise(request)
          </code>
        </pre>

        <h2 id="3dsecure">Authorise 3D</h2>

        <p>
          For 3D Secure, please see the following documentation: <a>https://docs.adyen.com/developers/api-manual#3dsecure</a>.<br><br>
          The main difference between a '3D secure' payment and a normal authorisation, is that the shopper is redirected to an
          issuer's website to enter their 3D Secure credentials.<br><br>
          This similar to a hpp payment, but requires different information to be passed along.
          <br><br>
          A 3D secure payment can be initiated with the regular 'adyen.payment.authorise' method, with the 'User-Agent' and 'Accept'
          headers from the client being added to the request ( in addition to the regular payment properties as described above ).
        </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
params['browserInfo'] = {}
params['browserInfo']['userAgent'] = request.headers["User-Agent"]
params['browserInfo']['acceptHeader'] = request.headers["Accept"]

result = adyen.payment.authorise(request=params)
        </code>
      </pre>

      <p>
        These parameters will initiate a 'directory lookup' for 3D secure by Adyen, to see if the card is enabled for 3D secure payments.
        If this is the case, the following extra values are give the response:
        <br>
        - paRequest<br>
        - md<br>
        - issuerUrl<br>
        - resultCode = "RedirectShopper"<br><br>

        The shopper can be redirected to the 'issuerUrl' where they can enter their 3D secure code.<br>
        Our documentation contains an <a href="https://docs.adyen.com/developers/api-manual#initiatea3dsecurepaymentwithanhtmlform">html example</a> form which can submitted from a client.<br><br>
        Note that the 'PaReq', 'MD' and 'IssuerUrl' are values that correspond with those in the response from calling the authorise method.<br><br>

        The values provided by the authorisation response should be set with the corresponding html form fields. In the HTML form is a 'TermUrl', this url
        is provided by your application, and similar to hosted payment pages, will be called after the shopper completes the 3D secure authorisation.
      </p>

      <h3 id="3dcallback">3D Secure Callback </h3>

      <p>
        The 'TermUrl' to which the shopper will be redirected is a http POST request. The request body contains 'MD'and 'PaRes' properties, the values of which
        need to be passed to the 'adyen.payment.authorise3d' method.<br><br>
        Note that for this request, the same 'browserInfo' object can be passed. ShopperIP is an optional value, but recommended to be added as this is additional data
        used for fraud detection.<br><br>

        The result from the authorise3d method will be similar to that of a regular card payment authorisation with the 'adyen.payment.authorise' method.
      </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request[<span class="hljs-string">'browserInfo'</span>] = {<span class="hljs-string">"userAgent"</span>:<span class="hljs-string">"User Agent"</span>,<span class="hljs-string">"acceptHeader"</span>:<span class="hljs-string">"Accept Header"</span>]}
request[<span class="hljs-string">'md'</span>] = "MD value from adyen.payment.authorise3d() response"
request[<span class="hljs-string">'paResponse'</span>] = <span class="hljs-string">"PaRes value from adyen.payment.authorise3D() response."</span>
request[<span class="hljs-string">'shopperIP'</span>] = <span class="hljs-string">"Optional: ip address of shopper client"</span>
result = adyen.payment.authorise3d(request=request)
        </code>
      </pre>

      <h2 id="modifications">Modifications</h2>

      <h3 id="cancelorrefund">Cancel or Refund</h3>

      <p>This request either cancels or refunds a payment depending on the status. If the payment is authorised but not yet settled
        it is cancelled, if it is settled it is refunded.
      </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request['originalReference'] = psp
request['amount'] = {'currency':'EUR','value':'original amount or lower, in minor units.'}

result = adyenbase.payment.cancel_or_refund(request=request)
        </code>
      </pre>

      <h3 id="cancel">Cancel</h3>

      <p>
        Cancels a payment if the status is still 'authorised', possible only before settlement.
      </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request['originalReference'] = "psp reference of original payment."

result = adyenbase.payment.cancel(request=request)
        </code>
      </pre>

      <h3 id="refund">Refund</h3>

      <p>
        To refund a payment
      </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request['originalReference'] = "psp reference of original payment."

result = adyenbase.payment.cancel(request=request)
        </code>
      </pre>

      <h3 id="capture">Capture</h3>

      <p>
        To capture a payment. For regular ecommerce, a capture is submitted once the goods are shipped.<br>
      </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {}
request['originalReference'] = "psp reference of original payment."
request['modificationAmount'] = {'currency':'EUR','value':<same or less than the original payment amount>}

result = adyenbase.payment.capture(request=request)
        </code>
      </pre>

      <h1 id="hpp">Hosted Payment Pages</h1>

      <p>
        Hosted Payment Pages ( 'hpp' ) work by redirecting a customer to Adyen's website, to complete a payment there. The benefit is that you do not have to implement
        a wide range of unique payment methods, and the customer is able to pay with the method they prefer.<br><br>
        For a general guide on HPP, please read the main Adyen documentation: https://docs.adyen.com/developers/hpp-manual.
        Hosted payment pages work with a 'hmac' key and a 'skin code' which are generated in the customer area. These attributes are set with the Adyen class
        instance and will be used by the library to process HPP requests.<br><br>
      </p>

      <h2 id="directorylookup">Directory lookup</h2>

      <p>
        To display available payment methods in your site or app, the 'directory lookup' method can be used. This returns a list
        of available payment methods for the shoppers location.<br><br>
        Below is an example request to the library. The 'countryCode' is optional, if it is set this is taken into account
        when returning a list of payment methods. The 'skinCode' property is optional, if it is not set the default skinCode
        attribute set with the Adyen class instance will be used.
      </p>

      <pre>
        <code class="python hljs" style="word-wrap:break-all;white-space:pre-wrap;overflow:visible">
request = {
  'currencyCode': 'EUR',
  'paymentAmount': '100',
  'sessionValidity': nnow.strftime('%Y-%m-%dT%H:%M:%SZ'),
  'countryCode': 'nl',
  'shipBeforeDate': '2017-01-01',
  'merchantReference': 'your unique reference',
  'skinCode': 'your Adyen skin code'
}

result = Adyen.hpp.directory_lookup(request)
        </code>
      </pre>


</section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/Adyen">Adyen</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>

  </body>
</html>
